const fs = require('fs')const git = require('simple-git/promise');const config = require('../config.json').repoconst couchdbConf = require('../couchdbConfig.json').couchdbconst nano = require('nano')('http://' + couchdbConf.login + ':' + couchdbConf.password + '@' + couchdbConf.host + ':' + couchdbConf.port + '');let repoDir = config.folderlet remote = config.source;const arr = []console.log(repoDir)function _checkRepos() {    if (!fs.existsSync(repoDir)) {        console.log('test')        git().clone(remote).then(() => console.log('finished')).catch((err) => console.error('failed: ', err));    }}function _getFile(dataName) {    var db = nano.use(dataName);    var tempObj = {}    var key = dataName;    tempObj[key] = [];    db.list(function(err, body) {        if (!err) {            const testBuf = 0            body.rows.forEach(function(doc) {                db.multipart.get(doc.id, (err, buffer, testBuf) => {                    tempObj[key].push(buffer)                    tempString = JSON.stringify(tempObj)                    fs.writeFile(repoDir + dataName + ".json", (replaceAll(tempString, '_rev', 'rev')), (err) => {                        if (err) throw err                        console.log("*")                    });                })            });        }     });}function replaceAll(str, find, replace) {    return str.replace(new RegExp(find, 'g'), replace);}function initialiseRepo(git) {    return git.init()        .then(() => git.addRemote('origin', remote))}function _commitChanges() {    require('simple-git')(repoDir)        .init()        .add('./*')        .commit(Date.now())        .addRemote('master', remote)        .push(['-u', 'origin', 'master'], () => console.log('done'));}function _getAllBases() {    nano.db.list(function(err, body) {        body.forEach(function(db) {            _getFile(db);        });    });}module.exports = function(db) {    _checkRepos();    _getAllBases();    _commitChanges();}