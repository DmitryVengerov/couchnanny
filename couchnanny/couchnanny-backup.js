const fs = require('fs')const path = require('path')const url = require('url')const git = require('simple-git/promise');const config = require('../config.json').repoconst couchdbConf = require('../config.json').couchdbconst remote = `https://github.com/DmitryVengerov/backuptest.git`;let nano = require('nano')('http://"'+couchdbConf.login+'":"' + couchdbConf.password + '"@' + couchdbConf.host + ':' + couchdbConf.port + '');let repoDir = config.foldervar repository;function checkRepos() {    if (!fs.existsSync(repoDir)) {        git().clone(remote).then(() => console.log('finished')).catch((err) => console.error('failed: ', err));    }}function _getFile(dataName) {    var temp = nano.use(dataName);    var tempObj = {}    var key = dataName;    tempObj[key] = [];    temp.list(function(err, body) {        if (!err) {            body.rows.forEach(function(doc) {                tempObj[key].push(doc);            });            fs.writeFile(repoDir + dataName + ".json", JSON.stringify(tempObj), (err) => {                if (err) throw err                console.log('The file has been saved!');            });        }    });}function _commitChanges() {    require('simple-git')()        .init()        .add('./backuptest/*')        .commit(Date.now())        .addRemote('origin', 'https://github.com/DmitryVengerov/backuptest.git')        .push('origin', 'master');}function _getAllBases() {    nano.db.list(function(err, body) {        body.forEach(function(db) {            console.log(db);        });    });}module.exports = function(db) {    //checkRepos();    //_getFile('_global_changes')    //_getFile('_users')    //_getFile('_replicator')    //_getFile('_metadata')    nano.db.list(function(err, body) {        body.forEach(function(db) {            console.log(db);        });    });    _commitChanges();}